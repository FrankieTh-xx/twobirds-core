this.Element&&function(ElementPrototype){ElementPrototype.matches=ElementPrototype.matches||ElementPrototype.matchesSelector||ElementPrototype.webkitMatchesSelector||ElementPrototype.msMatchesSelector||function(selector){for(var node=this,nodes=(node.parentNode||node.document).querySelectorAll(selector),i=-1;nodes[++i]&&nodes[i]!=node;);return!!nodes[i]}}(Element.prototype),this.Element&&function(ElementPrototype){ElementPrototype.closest=ElementPrototype.closest||function(selector){for(var el=this;el.matches&&!el.matches(selector);)el=el.parentNode;return el.matches?el:null}}(Element.prototype),tb=function(){function TbSelector(pSelector){var that=this;if(that.length=0,!pSelector)return that;if(pSelector instanceof tb)return[].concat.call(that,[pSelector]),that;switch(typeof pSelector){case"string":var selector=pSelector.split(" "),selector=selector.map(function(s){return 1<s.length?s+':not([data-tb=""])':s}),selector=selector.join(" ");tb.dom(selector).forEach(function(pDomNode){pDomNode.tb&&Object.keys(pDomNode.tb).forEach(function(pKey){[].push.call(that,pDomNode.tb[pKey])})});break;case"object":if(pSelector instanceof tb)return[].push.call(that,pSelector),that;pSelector instanceof RegExp?tb.dom("[data-tb]").forEach(function(pDomNode){Object.keys(pDomNode.tb).forEach(function(pKey){var tbElement=pDomNode.tb[pKey];tbElement instanceof tb&&tbElement.namespace&&tbElement.namespace.match(pSelector)&&[].push.call(that,tbElement)})}):pSelector.nodeType&&pSelector.tb?Object.keys(pSelector.tb).forEach(function(pKey){[].push.call(that,pSelector.tb[pKey])}):(pSelector.constructor===Array||pSelector.length&&pSelector[0]&&!(pSelector instanceof Array))&&[].forEach.call(pSelector,function(pThisSelector){var thisResult=tb(pThisSelector);[].forEach.call(thisResult,function(pTbElement){-1===[].indexOf.call(that,pTbElement)&&[].push.call(that,pTbElement)})});break;case"function":tb.dom("[data-tb]").map(function(pDomNode){Object.keys(pDomNode.tb).forEach(function(pKey){var tbElement=pDomNode.tb[pKey];tbElement instanceof tb&&tbElement instanceof pSelector&&[].push.call(that,tbElement)})})}return that}function Nop(){}function tb(){function makePrototype(pPrototype){var f=function(pPrototype){var that=this;for(var i in pPrototype)pPrototype.hasOwnProperty(i)&&(that[i]=pPrototype[i])};return f.prototype=tb.prototype,new f(pPrototype)}function mergeHandlers(pSourceTb,pTargetTb){for(var i in pSourceTb.handlers)if(pSourceTb.handlers.hasOwnProperty(i)){pTargetTb.handlers[i]||(pTargetTb.handlers[i]=[]);for(var j=0,l=pSourceTb.handlers[i].length;j<l;j++)pTargetTb.handlers[i].push(pSourceTb.handlers[i][j])}}var that=this;if(!(that instanceof tb))return new TbSelector(arguments[0]?arguments[0]:void 0);var tbInstance,fileName,tempInstance,isNamespace="string"==typeof arguments[0],tbClass=isNamespace?tb.namespace(arguments[0]).get():arguments[0];if(isNamespace&&!tbClass)return fileName=arguments[0].replace(/\./g,"/")+".js",tempInstance=new tb(Nop,arguments[1]||{},arguments[2]||!1),tb.loader.load(fileName,function(args){return function(){var thisTb=new tb(args[0],args[1]||{},args[2]||!1);if(tempInstance){for(var i in tempInstance)["handlers","target"].indexOf(i)===-1&&tempInstance.hasOwnProperty(i)&&(thisTb[i]=tempInstance[i]);mergeHandlers(tempInstance,thisTb)}}}([].slice.call(arguments))),tempInstance;if("function"==typeof tbClass){if(tbClass.prototype.__tb__||(tbClass.prototype.__tb__="V7",tbClass.prototype=makePrototype(tbClass.prototype,tbClass)),tbInstance=new tbClass(arguments[1]||{},arguments[2]),tbInstance.namespace||tbInstance instanceof Nop||(tbInstance.namespace="string"==typeof arguments[0]?arguments[0]:arguments[0].namespace||tb.getId()),tbInstance.target=arguments[2]||!1,arguments[2]?(!arguments[2].nodeType&&arguments[2][0]&&arguments[2][0].nodeType&&(arguments[2]=arguments[2][0]),tbInstance.target=arguments[2]):tbInstance.target=null,tbInstance.target&&tbInstance.target.nodeType&&!(tbInstance instanceof Nop)){tbInstance.target.tb=tbInstance.target.tb||{},tbInstance.target.tb[tbInstance.namespace]=tbInstance;var dom=tb.dom(tbInstance.target);if("head"!==tbInstance.target.nodeName&&dom.parents().toArray().indexOf(document.head)===-1&&tbInstance.namespace&&dom.addClass(tbInstance.namespace.replace(/\./g,"-").toLowerCase()),tbInstance.target&&tbInstance.target.nodeType){var dataTb=tbInstance.target.getAttribute("data-tb");dataTb&&dataTb.length&&-1===dataTb.split(" ").indexOf(tbInstance.namespace)?tbInstance.target.setAttribute("data-tb",dataTb+" "+tbInstance.namespace):tbInstance.target.setAttribute("data-tb",tbInstance.namespace)}}if(tbInstance.handlers)for(var i in tbInstance.handlers)tbInstance.handlers.hasOwnProperty(i)&&("function"==typeof tbInstance.handlers[i]?tbInstance.handlers[i]=[tbInstance.handlers[i]]:tbInstance.handlers[i]instanceof Array||delete tbInstance.handlers[i]);else tbInstance.handlers={};if(!(tbInstance instanceof Nop)){tbInstance["tb.Require"]||tbInstance.trigger("init");for(var key in tbInstance)"string"==typeof key&&key.indexOf(".")>-1&&(tbInstance[key]=new tb(key,tbInstance[key],tbInstance))}return tbInstance}}function walkSelector(pSelectorObject,pMethodName,pArguments){var result,ret=tb("");return pSelectorObject instanceof TbSelector&&[].forEach.call([].map.call(pSelectorObject,function(pElement,pKey){if(pSelectorObject.hasOwnProperty(pKey))return pSelectorObject[pKey]}),function(pTbObject,pKey){result=pTbObject[pMethodName].apply(pTbObject,[].slice.call(pArguments)),[].forEach.call(result,function(pResultObject){[].indexOf.call(ret,pResultObject)===-1&&[].push.call(ret,pResultObject)})}),ret}Nop.prototype={namespace:"Nop"},tb.Selector=TbSelector,tb.prototype=function(){return{set:function(pKey,pValue){var that=this;return that instanceof TbSelector?([].forEach.call(that,function(pElement){pElement.set(pKey,pValue)}),that):(that instanceof tb&&(that[pKey]=pValue),that)},get:function(pKey,undefined){var that=this;return that instanceof TbSelector?that[0][pKey]:that instanceof tb?that[pKey]:undefined},trigger:function(pEvent,pEventData,pBubble){var tbEvent,that=this;if(!tb.stop()){if(tbEvent=pEvent instanceof tb.Event?pEvent:new tb.Event(pEvent,pEventData,pBubble),tbEvent.__stopped__)return that;if(that instanceof TbSelector&&that.length)[].forEach.call(that,function(tbInstance){tbInstance&&tbInstance instanceof tb&&!tbEvent.__immediateStopped__&&tbInstance.trigger(tbEvent)});else if(that instanceof tb){if(that instanceof Nop&&"init"!==tbEvent.name)return that.one("init",function(){var that=this;that.trigger(tbEvent)}),that;if(that.handlers[tbEvent.name]&&tbEvent.bubble.indexOf("l")>-1){var temp=[];that.handlers[tbEvent.name].map(function(handler){tbEvent.bubble.indexOf("l")>-1&&!tbEvent.__immediateStopped__&&handler&&(setTimeout(function(){try{handler.apply(that,[tbEvent])}catch(e){console.error(e)}},0),handler.once||temp.push(handler))}),temp.length?that.handlers[tbEvent.name]=temp:(that.handlers[tbEvent.name]=null,delete that.handlers[tbEvent.name])}if(tbEvent.__stopped__)return that;setTimeout(function(){tbEvent.bubble.indexOf("u")>-1&&that.parent().trigger(new tb.Event(tbEvent.name,tbEvent.data,"lu")),tbEvent.bubble.indexOf("d")>-1&&[].forEach.call(that.children(),function(tbObject){tbObject.trigger(new tb.Event(tbEvent.name,tbEvent.data,"ld"))})},10)}return that}},on:function(pEventName,pHandler,pOnce){var eventNames,that=this;return that instanceof TbSelector?walkSelector(that,"on",arguments):that instanceof tb&&(eventNames=-1<pEventName.indexOf(" ")?pEventName.split(" "):[pEventName],pHandler.once=!!pHandler.once||!!pOnce,eventNames.forEach(function(pThisEventName){that.handlers||(that.handlers={}),that.handlers[pThisEventName]||(that.handlers[pThisEventName]=[]),that.handlers[pThisEventName].push(pHandler)})),that},one:function(pEventName,pHandler){var that=this;return that.on(pEventName,pHandler,!0),that},off:function(pEventName,pHandler){var index,eventNames,that=this;return"undefined"==typeof pEventName?that:(that instanceof TbSelector?walkSelector(that,"off",arguments):that instanceof tb&&(eventNames=-1<pEventName.indexOf(" ")?pEventName.split(" "):[pEventName],eventNames.forEach(function(pThisEventName){if(that.handlers[pThisEventName])if("undefined"!=typeof pHandler)for(index=that.handlers[pThisEventName].indexOf(pHandler);index>-1;)that.handlers[pThisEventName].splice(index,1),index=that.handlers[pThisEventName].indexOf(pHandler),0===that.handlers[pThisEventName].length&&(that.handlers[pThisEventName]=null,delete that.handlers[pThisEventName]);else that.handlers[pThisEventName]=null,delete that.handlers[pThisEventName]})),that)},parents:function(pSelector){var that=this,ret=tb();return that instanceof TbSelector?ret=walkSelector(that,"parents",arguments):that instanceof tb&&that.target&&(that.target.nodeType?tb.dom(that.target).parents("[data-tb]").not("html").toArray().forEach(function(pElement){Object.keys(pElement.tb).forEach(function(pKey){[].push.call(ret,pElement.tb[pKey])})}):that.target instanceof tb&&([].push.call(ret,that.target),that.target.parent()[0]&&[].push.call(ret,that.target.parent()[0]))),pSelector?ret.filter(pSelector):ret},parent:function(pSelector){var that=this,ret=tb();if(that instanceof TbSelector)ret=walkSelector(that,"parent",arguments);else if(that instanceof tb&&that.target)if(that.target.nodeType){var tbParents=that.parents().toArray(),tbParent=!!tbParents[0]&&tbParents[0];if(!tbParent)return ret;Object.keys(tbParent.target.tb).forEach(function(pKey){[].push.call(ret,tbParent.target.tb[pKey])})}else that.target instanceof tb&&[].push.call(ret,that.target);return pSelector?ret.filter(pSelector):ret},descendants:function(pSelector,pLocalOnly){var that=this,ret=tb();return that instanceof TbSelector?ret=walkSelector(this,"descendants",arguments):that instanceof tb&&that.target.nodeType&&!pLocalOnly?tb.dom("[data-tb]",that.target).forEach(function(pDomNode){Object.keys(pDomNode.tb).forEach(function(pKey){[].push.call(ret,pDomNode.tb[pKey])})}):that instanceof tb&&pLocalOnly&&Object.keys(that).forEach(function(pKey){if("target"!==pKey&&that[pKey]instanceof tb){[].push.call(ret,that[pKey]);for(var desc=tb.dom().toArray.call(that[pKey].descendants("",!0)),j=0,l=desc.length;j<l;j++)[].push.call(ret,desc[j])}}),pSelector?ret.filter(pSelector):ret},children:function(pSelector,pLocalOnly){var that=this,ret=tb(),pLocalOnly="undefined"!=typeof module||pLocalOnly;if(that instanceof TbSelector)ret=walkSelector(that,"children",arguments);else if(that instanceof tb&&that.target.nodeType&&!pLocalOnly){var id=tb.getId(),selector=tb.dom("[data-tb]",that.target),notSelector='[data-tempid="'+id+'"] [data-tb] *';tb.dom(that.target).attr("data-tempid",id),selector.not(notSelector).forEach(function(pDomNode){Object.keys(pDomNode.tb).forEach(function(pKey){[].push.call(ret,pDomNode.tb[pKey])})}),tb.dom(that.target).removeAttr("data-tempid")}else if(pLocalOnly)for(var i in that)that.hasOwnProperty(i)&&that[i]instanceof tb&&[].push.call(ret,that[i]);return pSelector?ret.filter(pSelector):ret},next:function(pSelector){var result,index,that=this,ret=tb("");return that instanceof TbSelector?ret=walkSelector(this,"next",arguments):(result=that.parent().children(),index=[].indexOf.call(result,that),result.length>index+1&&[].push.call(ret,result[index+1])),pSelector?ret.filter(pSelector):ret},prev:function(pSelector){var result,index,that=this,ret=tb("");return that instanceof TbSelector?ret=walkSelector(this,"prev",arguments):(result=this.parent().children(),index=[].indexOf.call(result,this),index&&[].push.call(ret,result[index-1])),pSelector?ret.filter(pSelector):ret},first:function(pSelector){var result,that=this,ret=tb("");return that instanceof TbSelector?ret=walkSelector(this,"first",arguments):(result=this.parent().children(),[].push.call(ret,result[0])),pSelector?ret.filter(pSelector):ret},last:function(pSelector){var result,that=this,ret=tb("");return that instanceof TbSelector?ret=walkSelector(this,"last",arguments):(result=this.parent().children(),[].push.call(ret,result[result.length-1])),pSelector?ret.filter(pSelector):ret},toArray:function(){var that=this,result=[].filter.call(that,function(){return!0});return result},filter:function(pSelector){var that=this,compare=tb(pSelector),ret=tb();return pSelector?(that instanceof TbSelector?[].forEach.call(that,function(tbObject){-1<[].indexOf.call(compare,tbObject)&&[].push.call(ret,tbObject)}):that instanceof tb&&-1<[].indexOf.call(compare,that)&&[].push.call(ret,that),ret):that},not:function(pSelector){var that=this,compare=tb(pSelector).toArray(),ret=tb();return[].forEach.call(that,function(pTbInstance){compare.indexOf(pTbInstance)===-1&&[].push.call(ret,pTbInstance)}),ret},add:function(pSelector){var ret,that=this,check=tb(pSelector).toArray();return that instanceof TbSelector?ret=that:(ret=tb(""),[].push.call(ret,that)),check.forEach(function(tbObject){-1===[].indexOf.call(ret,tbObject)&&[].push.call(ret,tbObject)}),ret}}}(),TbSelector.prototype={};for(var i in tb.prototype)tb.prototype.hasOwnProperty(i)&&(TbSelector.prototype[i]=tb.prototype[i]);return tb}(),tb.Event=function(pEventName,pEventData,pBubble){var that=this;that.bubble=pBubble||"l",that.data=pEventData||{},that.name=pEventName||"",that.__stopped__=that.__immediateStopped__=!1},tb.Event.prototype={stopPropagation:function(){return this.__stopped__=!0,this},stopImmediatePropagation:function(){return this.stopPropagation(),this.__immediateStopped__=!0,this}},"undefined"!=typeof module&&module.exports?module.exports.tb=tb:!function(){function domReady(){tb.bind(document.body)}document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),domReady()},!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),domReady())})}(),"undefined"==typeof module&&(tb.dom=function(){var regExWord=/\S+/g,TbSelector=tb.Selector;return function(pSelector,pDomNode){function _addEvent(pDomNode,pEventName,pHandler){pDomNode.attachEvent?pDomNode.attachEvent("on"+pEventName,pHandler):pDomNode.addEventListener(pEventName,pHandler)}function _removeEvent(pDomNode,pEventName,pHandler){pDomNode.detachEvent?pDomNode.detachEvent("on"+pEventName,pHandler):pDomNode.removeEventListener(pEventName,pHandler)}function _htmlToElements(html){var template=document.createElement("template");return template.innerHTML=html,template.content.childNodes?template.content.childNodes:template.childNodes}function _mapArrayMethod(pMethodName){var method=[][pMethodName];return function(){var arr=this.toArray(),ret=method.apply(arr,arguments);return tb.dom(ret).unique()}}function add(pSelector){var res,that=this;return"string"!=typeof pSelector&&pSelector.length?[].forEach.call(pSelector,function(pSelected){res=tb.dom(pSelected).toArray(),res.forEach(function(pDomNode){[].indexOf.call(that,pDomNode)===-1&&[].push.call(that,pDomNode)})}):(res=tb.dom(pSelector).toArray(),res.forEach(function(pDomNode){[].indexOf.call(that,pDomNode)===-1&&[].push.call(that,pDomNode)})),that.unique()}function addClass(pClassName){var that=this;return that.forEach(function(pDomNode){var classes=pDomNode.getAttribute("class")||"",classes=classes.length?classes.split(" "):[],index=classes.indexOf(pClassName);index===-1&&(classes.push(pClassName),pDomNode.setAttribute("class",classes.join(" ")))}),that}function append(pElement){var nodes,that=this;return that.forEach(function(pDomNode){nodes=tb.dom(pElement),[].forEach.call(nodes,function(pThisElement){pThisElement.nodeType&&pDomNode.appendChild(pThisElement)})}),that}function appendTo(pElement){var that=this;return pElement=tb.dom(pElement),pElement[0]&&(pElement=pElement[0],that.forEach(function(pDomNode){pElement.appendChild(pDomNode)})),that}function children(pSelector){var that=this,result=tb.dom();return that.forEach(function(pDomNode){var check=void 0!==pSelector&&pDomNode.querySelectorAll(pSelector);[].forEach.call(pDomNode.children,function(pChildNode){-1===[].indexOf.call(result,pChildNode)&&(!check||-1<[].indexOf.call(check,pChildNode))&&result.push(pChildNode)})}),result}function descendants(pSelector){var ret,that=this,result=[],check=!!pSelector&&tb.dom(pSelector);return that.forEach(function(pDomNode){result=result.concat(tb.dom(pDomNode.querySelectorAll("*")).toArray())}),result=tb.dom(result).unique().toArray(),check&&(ret=result.filter(function(pDomNode){return-1<[].indexOf.call(check,pDomNode)})),tb.dom(check?ret:result)}function insertBefore(pTarget){var that=this;return that.forEach(function(pDomNode){pDomNode.nodeType&&pTarget.nodeType&&pTarget.parentElement.insertBefore(pDomNode.cloneNode(!0),pTarget)}),that}function insertAfter(pTarget){var that=this,nextDomNode=pTarget.nextSibling||!1;return that.forEach(function(pDomNode){pDomNode.nodeType&&(nextDomNode?pTarget.parentElement.insertBefore(pDomNode.cloneNode(!0),nextDomNode):pTarget.parentElement.appendChild(pDomNode.cloneNode(!0)))}),that}function remove(pDomNodes){var that=this;return that.forEach(function(pDomNode){pDomNode.parentNode.removeChild(pDomNode)}),that}function trigger(pEventName,pData){var that=this,eventNames=pEventName.split(" ");return that.forEach(function(pDomNode){pDomNode.nodeType&&eventNames.forEach(function(pThisEventName){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.data=pData,e.initEvent(pThisEventName,!1,!0),pDomNode.dispatchEvent(e)}else{var e=document.createEventObject();e.data=pData,e.eventType=pThisEventName,pDomNode.fireEvent("on"+e.pThisEventName,e)}})}),that}function on(pEventName,pHandler){var onceHandler,that=this,eventNames=pEventName.indexOf(" ")>-1?pEventName.split(" "):[pEventName];return that.forEach(function(pDomNode){pDomNode.nodeType&&eventNames.forEach(function(pThisEventName){pHandler.once&&(onceHandler=function(pDomNode,pThisEventName,pHandler){return function(){_removeEvent(pDomNode,pThisEventName,onceHandler),pHandler.apply(pDomNode,arguments)}}(pDomNode,pThisEventName,pHandler)),_addEvent(pDomNode,pThisEventName,onceHandler||pHandler)})}),that}function one(pEventName,pHandler){var that=this;return pHandler.once=!0,that.on(pEventName,pHandler),that}function off(pEventName,pHandler){var that=this,eventNames=pEventName.indexOf(" ")>-1?pEventName.split(" "):[pEventName];return that.forEach(function(pDomNode){pDomNode.nodeType&&pHandler&&eventNames.forEach(function(pThisEventName){_removeEvent(pDomNode,pThisEventName,pHandler)})}),that}function empty(){var that=this;return that.forEach(function(pNode){pNode.innerHTML=""}),that}function html(pHtml){var that=this;return pHtml?("string"==typeof pHtml&&that.forEach(function(pNode){pNode.innerHTML=pHtml}),that):that[0]?that[0].innerHTML:""}function hide(){var that=this;return that.forEach(function(pNode){pNode.style.prevDisplay=["","none"].indexOf(pNode.style.display)===-1?pNode.style.display:"",pNode.style.display="none"}),that}function show(){var that=this;return that.forEach(function(pNode){pNode.style.display=pNode.style.prevDisplay}),that}function unique(){var that=this,result=[];return[].forEach.call(that,function(pElement){result.indexOf(pElement)===-1&&result.push(pElement)}),tb.dom(result)}function not(pSelector){var that=this,result=tb.dom(),check=void 0!==pSelector&&document.querySelectorAll(pSelector);return check?(that.forEach(function(pElement){-1===[].indexOf.call(check,pElement)&&result.add(pElement)}),result):that}function parents(pSelector){var nextNode,that=this,result=tb.dom(),check=void 0!==pSelector&&document.querySelectorAll(pSelector);return that.forEach(function(pDomNode){for(var domNode=pDomNode.parentNode;domNode&&domNode.tagName&&"html"!==domNode.tagName;)nextNode=domNode.parentNode,[].indexOf.call(result,domNode)===-1&&(!check||-1<[].indexOf.call(check,domNode))&&result.push(domNode),domNode=nextNode}),result}function parent(pSelector){var that=this,result=tb.dom(),check=void 0!==pSelector&&document.querySelectorAll(pSelector);return that.forEach(function(pDomNode){var domNode=pDomNode.parentNode;-1===[].indexOf.call(result,domNode)&&(!check||-1<[].indexOf.call(check,domNode))&&[].push.call(result,domNode)}),result}function removeClass(pClassName){var that=this;return pClasses=pClassName.split(" "),that.forEach(function(pDomNode){var classes=pDomNode.getAttribute("class")||"";pClasses.forEach(function(pClass){classes&&(classes=classes.indexOf(" ")+1?classes.split(" "):[classes],pClassName.split(" ").forEach(function(pRemoveClass){for(;classes.indexOf(pRemoveClass)>-1;)classes.splice(classes.indexOf(pRemoveClass),1)}),classes.length?tb.dom(pDomNode).attr("class",classes.join(" ")):tb.dom(pDomNode).removeAttr("class"))})}),that}function attr(pKey,pValue){var rootNodes,that=this;if(pKey.constructor===Object)Object.keys(pKey).forEach(function(thisKey){that.attr(thisKey,pKey[thisKey])});else{if(!pValue&&that.length>0)return that[0].getAttribute(pKey);rootNodes=that.toArray(),rootNodes.forEach(function(pNode){return pKey.constructor===Object?void Object.keys(pKey).forEach(function(thisKey){pNode.setAttribute(thisKey,pKey[thisKey])}):void pNode.setAttribute(pKey,pValue)})}return that}function removeAttr(pKeys){var name,i,that=this,attrNames=pKeys&&pKeys.match(regExWord);return that.forEach(function(pDomNode){if(i=0,attrNames&&pDomNode.nodeType&&1===pDomNode.nodeType)for(;name=attrNames[i++];)pDomNode.removeAttribute(name)}),that}function toArray(){var that=this,result=[];return that.length&&[].map.call(that,function(pElement){result.push(pElement)}),result}function filter(pSelector){var result,that=this,compare=tb.dom(pSelector);if("undefined"===pSelector)return that;if("string"==typeof pSelector)result=[].filter.call(that,function(pElement){return-1<compare.indexOf(pElement)});else if("function"==typeof pSelector)return result=[].filter.call(that,pSelector);return tb.dom(result)}function push(pSelector){var that=this;return"undefined"==typeof pSelector?that:(pSelector.length?[].forEach.call(pSelector,function(pElement){pElement.nodeType&&that.push(pElement)}):pSelector.nodeType?[].push.call(that,pSelector):"string"==typeof pSelector&&that.push(tb.dom(pSelector).toArray()),that.unique())}function val(pValue){var ret,that=this,valHandlers={select:function(pValue){var ret,that=this,multiSelect="select-multiple"===that.type;return arguments.length?(pValue=multiSelect&&pValue.constructor!==Array?[pValue]:pValue,pValue=multiSelect||pValue.constructor!==Array?pValue:[pValue[0]],tb.dom("option",that).removeAttr("selected"),pValue.forEach(function(pThisOptionValue){tb.dom('option[value="'+pThisOptionValue+'"]',that).attr({selected:"selected"})}),that):(ret=[],tb.dom("option:selected",that).forEach(function(pThisSelectedOption){if(!(option.disabled||option.parentNode.disabled&&"optgroup"===option.parentNode.nodeName)){var value=pThisSelectedOption.value;if(!multiSelect)return value;ret.push(value)}}),ret)},"default":function(pValue){var ret,that=this;return["radio","checkbox"].indexOf(that.type)>-1?(arguments.length&&(that.checked=!!pValue),that.checked):arguments.length?(null==pValue?pValue="":"number"==typeof val&&(pValue+=""),void(that.value=pValue)):(ret=that.value,"string"==typeof ret?ret:null==ret?"":ret)}};return arguments.length?(that.forEach(function(pElement){var inputTags=["input","select","option","textarea"];1===pElement.nodeType&&inputTags.indexOf(pElement.tagName.toLowerCase())!==-1&&(ret=valHandlers[pElement.tagName.toLowerCase()]?valHandlers[pElement.tagName.toLowerCase()].call(pElement,pValue):valHandlers["default"].call(pElement,pValue))}),that):(that.some(function(pElement){var inputTags=["input","select","option","textarea"];return 1===pElement.nodeType&&inputTags.indexOf(pElement.tagName.toLowerCase())!==-1&&(ret=valHandlers[pElement.tagName.toLowerCase()]?valHandlers[pElement.tagName.toLowerCase()].call(pElement):valHandlers["default"].call(pElement),!0)}),ret)}var dom;return dom=function(pSelector,pDomNode){var domNode,nodeList,that=this;if(pSelector){if(pSelector.nodeType)return void([].indexOf.call(that,pSelector)===-1&&[].push.call(that,pSelector));if(pSelector.__tbSelector__)return pSelector;if(pSelector instanceof TbSelector&&pSelector[0])return void[].forEach.call(pSelector,function(pElement){pElement.target&&pElement.target.nodeType&&[].indexOf.call(that,pElement.target)===-1&&[].push.call(that,pElement.target)});if(pSelector instanceof Array||pSelector.__tbSelector__||pSelector instanceof HTMLCollection||pSelector instanceof NodeList)return void[].forEach.call(pSelector,function(pElement){tb.dom(pElement).forEach(function(pFoundDomNode){[].indexOf.call(that,pFoundDomNode)===-1&&[].push.call(that,pFoundDomNode)})});if("string"==typeof pSelector){var DOM=_htmlToElements(pSelector);return 1!==DOM.length||3!==DOM[0].nodeType?tb.dom(DOM):(domNode=pDomNode&&pDomNode.nodeType?pDomNode:document,void pSelector.split(",").forEach(function(pThisSelector){nodeList=domNode.querySelectorAll(pThisSelector),nodeList[0]&&[].forEach.call(nodeList,function(pDomElement){[].indexOf.call(that,pDomElement)===-1&&[].push.call(that,pDomElement)})}))}}},dom.prototype={__tbSelector__:!0,length:0,concat:_mapArrayMethod("concat"),every:_mapArrayMethod("every"),forEach:_mapArrayMethod("forEach"),indexOf:_mapArrayMethod("indexOf"),lastIndexOf:_mapArrayMethod("lastIndexOf"),map:_mapArrayMethod("map"),pop:_mapArrayMethod("pop"),reduce:_mapArrayMethod("reduce"),reduceRight:_mapArrayMethod("reduceRight"),reverse:_mapArrayMethod("reverse"),shift:_mapArrayMethod("shift"),slice:_mapArrayMethod("slice"),some:_mapArrayMethod("some"),splice:_mapArrayMethod("splice"),unshift:_mapArrayMethod("unshift"),add:add,addClass:addClass,append:append,appendTo:appendTo,attr:attr,children:children,descendants:descendants,empty:empty,hide:hide,html:html,insertBefore:insertBefore,insertAfter:insertAfter,filter:filter,not:not,off:off,on:on,one:one,parent:parent,parents:parents,push:push,remove:remove,removeAttr:removeAttr,removeClass:removeClass,show:show,toArray:toArray,trigger:trigger,unique:unique,val:val},new dom(pSelector,pDomNode)}}()),tb.observable=function(pStartValue){var observedValue=pStartValue,observableFunction=function(p1,p2){function notify(){observableFunction.lastChanged=(new Date).getTime(),observableFunction.notify()}if("undefined"!=typeof p1){if("object"==typeof observedValue){if("string"==typeof p1){if("undefined"==typeof p2)return tb.namespace(p1,observedValue).get();p1.indexOf(".")>-1?tb.namespace(p1,observedValue).set(p2):observedValue[p1]=p2,notify()}else"object"==typeof p1&&"undefined"==typeof p2?(observedValue=p1,notify()):console.warn("tb.observable() set value: parameter 1 should be a string or object if observed data is an object!");return observedValue}return"undefined"!=typeof p1&&(observedValue=p1,notify()),observedValue}return observedValue};return observableFunction.lastChanged=(new Date).getTime(),observableFunction.notifiers=[],observableFunction.notify=function(){observableFunction.notifiers.forEach(function(func,key){"function"==typeof func?(func(observedValue),func.once&&observableFunction.notifiers.splice(key,1)):observableFunction.notifiers.splice(key,1)})},observableFunction.observe=function(pFunction,pOnce){pFunction.once=pOnce||!1,observableFunction.notifiers.push(pFunction)},observableFunction},tb.namespace=function(){function Namespace(pNamespace,pObject){var that=this;that.namespace=pNamespace,that.target=pObject,that.namespaceArray=pNamespace.indexOf(".")?pNamespace.split("."):pNameSpace,that.forceCreation=!1}function _walk(o,namespaceArray){var that=this;return!o[namespaceArray[0]]&&this.forceCreation&&(o[namespaceArray[0]]={}),namespaceArray.length<2?(that.forceCreation&&that.value&&(o[namespaceArray[0]]=that.value),o.hasOwnProperty(namespaceArray[0])?o[namespaceArray[0]]:void 0):o.hasOwnProperty(namespaceArray[0])?(o=o[namespaceArray[0]],namespaceArray.shift(),that._walk(o,namespaceArray)):void 0}function get(){var that=this;return that.forceCreation=!1,that._walk(that.target?that.target:window,that.namespaceArray)}function set(pValue){var that=this;return that.value=pValue,that.forceCreation=!0,that._walk(that.target?that.target:window,that.namespaceArray)}return Namespace.prototype={get:get,set:set,_walk:_walk},function(pNamespace,pObject){return new Namespace(pNamespace,pObject)}}(),tb.bind=function(pRootNode){var rootNode=pRootNode||document.body,foundElements=tb.dom(rootNode.querySelectorAll("[data-tb]")).toArray();rootNode.getAttribute("data-tb")&&(foundElements=[rootNode].concat(foundElements)),foundElements.forEach(function(pElement){var namespaces=pElement.getAttribute("data-tb").split(" ");namespaces.forEach(function(pNamespace){pElement.tb=pElement.tb||{},pElement.tb[pNamespace]||new tb(pNamespace,null,pElement)})})},tb.status={loadCount:tb.observable(0)},tb.idle=function(pCallback){var f=function(){if(0===tb.status.loadCount()){f.lastChanged=tb.status.loadCount.lastChanged;var tf=function(){var x=tb.status.loadCount();0===x&&tb.loader.idle()&&tb.status.loadCount.lastChanged===f.lastChanged?"function"==typeof pCallback&&pCallback():(f.lastChanged=tb.status.loadCount.lastChanged,setTimeout(tf,50))};setTimeout(tf,50)}else tb.status.loadCount.observe(f,!0)};tb.status.loadCount.observe(f,!0)},tb.getId=function(){return"id-"+(new Date).getTime()+"-"+Math.random().toString().replace(/\./,"")},tb.extend=function(pObj){for(var cp;arguments[1];)cp=arguments[1],Object.keys(cp).forEach(function(key){null!==cp[key]&&cp[key][constructor]&&cp[key].constructor===Object?pObj[key]=tb.extend(pObj[key]||{},cp[key]):pObj[key]=cp[key]}),[].splice.call(arguments,1,1);return pObj},tb.parse=function(pWhat,pParse){if("string"==typeof pWhat){var vars=pWhat.match(/\{[^\{\}]*\}/g);vars&&vars.forEach(function(pPropname){var propname=pPropname.substr(1,pPropname.length-2),propValue=tb.namespace(propname,pParse).get()||propname+" not found!";pWhat=pWhat.replace(pPropname,propValue)})}else if(pWhat.constructor)switch(pWhat.constructor){case Object:Object.keys(pWhat).forEach(function(pKey){pWhat.hasOwnProperty(pKey)&&(pWhat[pKey]=tb.parse(pWhat[pKey],pParse))});break;case Array:pWhat.forEach(function(pValue,pKey){pWhat[pKey]=tb.parse(pWhat[pKey],pParse)})}return pWhat},"undefined"==typeof module&&(tb.request=function(){function getConnection(pId){var xhr,getConnection,obj={};if("undefined"!=typeof ActiveXObject)for(var i=0;i<msoft.length;++i)try{xhr=new ActiveXObject(msoft[i]),obj={connection:xhr,identifier:pId},getConnection=function(pType){return function(pId){new ActiveXObject(pType);return obj={connection:xhr,identifier:pId}}}(msoft[i])}catch(e){}try{xhr=new XMLHttpRequest,obj={connection:xhr,identifier:pId},getConnection=function(pId){var xhr=new XMLHttpRequest;return obj={connection:xhr,identifier:pId}}}catch(e){}finally{return obj}}function handleReadyState(pReq,pCallback,pStateChange,pFailure,pOptions){var poll=window.setInterval(function(pReadyState){return function(){pReq.connection.readyState!==pReadyState&&(pReadyState=pReq.connection.readyState),4===pReadyState&&(pReq.aborttimer&&window.clearTimeout(pReq.aborttimer),window.clearInterval(poll),handleTransactionResponse(pReq,pCallback,pFailure,pOptions))}}(0),interval);return poll}function handleTransactionResponse(pReq,pCallback,pFailure,pOptions){try{var httpStatus=pReq.connection.status}catch(e){var httpStatus=13030}if(httpStatus>=200&&httpStatus<300){var responseObject=createResponseObject(pReq,pOptions);try{pCallback.call(pCallback,responseObject)}catch(e){tb.debug}}else{var responseObject=createResponseObject(pReq,tb.extend({},pOptions));pFailure.call(pFailure,responseObject)}release(pReq)}function createResponseObject(pObj,pOptions){var obj={tId:pObj.identifier,status:pObj.connection.status,statusText:pObj.connection.statusText,allResponseHeaders:pObj.connection.getAllResponseHeaders(),text:pObj.connection.responseText,xml:pObj.connection.responseXML,options:pOptions};return obj}function release(pReq){
dec(pReq),pReq.connection&&(pReq.connection=null),delete pReq.connection,pReq=null,delete pReq}function inc(pReq){tb.status.loadCount(tb.status.loadCount()+1),loadlist.push(pReq),count++,readyState="loading"}function dec(pReq){tb.status.loadCount(tb.status.loadCount()-1),loadlist.indexOf(pReq)&&(count--,loadlist.splice(loadlist.indexOf(pReq)),0===count&&(readyState="complete"))}var loadlist=[],readyState="complete",count=0,interval=30,msoft=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];return function(pOptions){var uid="tb"+tb.getId(),xmlreq=!1,method=!!pOptions.method&&pOptions.method.toUpperCase()||"GET",url=pOptions.url,params="",successHandler=pOptions.success||tb.nop,errorHandler=pOptions.error||tb.nop,stateHandler=pOptions.statechange||tb.nop,timeout=(pOptions.cachable||!1,pOptions.timeout||!1),isAsync="undefined"==typeof pOptions.async||pOptions.async!==!1;if("undefined"!=typeof pOptions.params){var ct=pOptions.headers&&pOptions.headers["Content-Type"]?pOptions.headers["Content-Type"]:"application/x-www-form-urlencoded";switch(ct){case"application/json":params=JSON.stringify(pOptions.params);break;default:for(var i in pOptions.params)params+=(params.length>0?"&":"")+i+"="+pOptions.params[i]}}if(inc(),xmlreq=getConnection(uid)){if("GET"!==method&&"DELETE"!==method||""===params||(url=url+(url.indexOf("?")<0?"?":"&")+params),xmlreq.src=url,xmlreq.connection.open(method,url,isAsync),isAsync===!0&&(xmlreq.poll=handleReadyState(xmlreq,successHandler,stateHandler,errorHandler,pOptions)),pOptions.headers)for(var i in pOptions.headers)"Content-Type"!==i&&xmlreq.connection.setRequestHeader(i,pOptions.headers[i]);return timeout&&(xmlreq.timeoutTimer=window.setTimeout(function(pT,pR){var f="function"==typeof pT.cb&&pT.cb;return function(){"function"==typeof f&&f(),pR.connection.abort(),window.clearInterval(pR.poll)}}(timeout,xmlreq),timeout.ms)),xmlreq.abort=function(xmlreq){return function(){window.clearInterval(xmlreq.poll),xmlreq.connection&&xmlreq.connection.abort(),release(xmlreq)}}(xmlreq),("POST"===method||"PUT"===method)&&""!==params?(xmlreq.connection.setRequestHeader("Content-Type",ct),xmlreq.connection.send(params)):xmlreq.connection.send(null),isAsync!==!1?xmlreq:(tb.request.dec(),void(xmlreq.connection.status>=200&&xmlreq.connection.status<300?successHandler(xmlreq):errorHandler(xmlreq)))}return!1}}()),tb.stop=function(pStopIt){var stopIt=pStopIt;return function(pStopIt){return stopIt=pStopIt?pStopIt:stopIt}}(!1),"undefined"==typeof module&&(tb.Model=function(pConfig){var that=this;that.data=tb.observable({}),that.config={},tb.extend(that.config,{create:{url:"",method:"POST",success:function(pResult){that.data(pResult)}},read:{url:"",method:"GET",success:function(pResult){that.data(pResult)}},update:{url:"",method:"PUT",success:function(pResult){that.data(pResult)}},"delete":{url:"",method:"DELETE",success:function(pResult){that.data(pResult)}}},pConfig)},tb.Model.prototype=function(){return{create:function(pParams){var o=tb.extend({},this.config.create);return o.url?void tb.request(tb.extend(o,{url:pParams?tb.parse(this.config.create.url,pParams):this.config.create.url},{params:pParams})):void console.error("no create url given!")},read:function(pParams){var o=tb.extend({},this.config.read);return o.url?void tb.request(tb.extend(o,{url:pParams?tb.parse(this.config.read.url,pParams):this.config.read.url},{params:pParams})):void console.error("no read url given!")},update:function(pParams){var o=tb.extend({},this.config.update);return o.url?void tb.request(tb.extend(o,{url:pParams?tb.parse(this.config.update.url,pParams):this.config.update.url},{params:pParams})):void console.error("no update url given!")},"delete":function(pParams){var o=tb.extend({},this.config["delete"]);return o.url?void tb.request(tb.extend(o,{url:pParams?tb.parse(this.config["delete"].url,pParams):this.config["delete"].url},{params:pParams})):void console.error("no delete url given!")}}}()),"undefined"==typeof module?(tb.Require=function(pConfig,pCallback){var that=this;pConfig&&(that.requirements=pConfig,tb.loader.load(that.requirements,function(){that.target&&that.target["tb.Require"]&&that.target.trigger("init"),"function"==typeof pCallback&&pCallback()}))},tb.Require.prototype={ready:function(){}},function(){function getTypeFromSrc(pSrc){return pSrc.split("?")[0].split(".").pop()}function _Requirement(pConfig){function onLoad(e){e&&e.data&&that.data(e.data),that.done=!0,"js"===that.type?setTimeout(function(){tb.status.loadCount(tb.status.loadCount()-1)},50):tb.status.loadCount(tb.status.loadCount()-1),that.trigger("requirementLoaded",that.src,"u")}var typeConfig,element,that=this,type=getTypeFromSrc(pConfig.src),typeConfigs={css:{tag:"link",attributes:{type:"text/css",rel:"stylesheet",href:"{src}"}},js:{tag:"script",attributes:{type:"text/javascript",src:"{src}"}}},isTyped=!!typeConfigs[type];if(tb.loader.requirementGroups[type][pConfig.src.split("?")[0]]&&tb.loader.requirementGroups[type][pConfig.src.split("?")[0]].done)return void that.trigger("requirementLoaded",src.split("?")[0],"u");if(tb.status.loadCount(tb.status.loadCount()+1),pConfig.type=type,that.config=pConfig,that.config.src&&(that.config.src=that.config.src+(that.config.src.indexOf("?")>-1?"&":"?")+tb.getId()),that.src=pConfig.src,that.type=that.config.type=type,that.done=!1,that.cb=that.config.cb||function(){},that.data=tb.observable({}),onLoad.once=!0,that.handlers={onLoad:onLoad},isTyped){typeConfig=typeConfigs[type],element=document.createElement(typeConfig.tag),element.async=!0,element.onreadystatechange=element.onload=function(){var state=element.readyState;that.done||state&&!/loaded|complete/.test(state)||that.trigger("onLoad",element)};for(var i in typeConfig.attributes)typeConfig.attributes.hasOwnProperty(i)&&element.setAttribute(i,tb.parse(typeConfig.attributes[i],that.config));document.getElementsByTagName("head")[0].appendChild(element),that.element=element}else{var f=function(data){if("json"===that.type&&data.text)try{data=JSON.parse(data.text)}catch(e){console.log("error parsing, JSON expected in:",data)}else data=data.text;that.trigger("onLoad",data)},options={url:that.src,success:f,error:f};tb.request(options)}}function _RequirementGroup(pConfig){var that=this;that.type=pConfig.type,that.target=pConfig.target,that.requirements={}}function Loader(pConfig){var that=this;that.config=pConfig,that.requirementGroups={},that.rqSets=[],that.handlers={requirementLoaded:requirementLoaded}}function requirementLoaded(e){var that=this,filename=e.data.split("?")[0];that.rqSets.forEach(function(pRqSet){pRqSet.done(filename),0===pRqSet.length&&pRqSet.callback()}),that.rqSets=that.rqSets.filter(function(pElement){return pElement.length>0}),e.stopPropagation()}_Requirement.prototype={namespace:"_Requirement"},_RequirementGroup.prototype={namespace:"_RequirementGroup",load:function(pSrc){var that=this,rq=!!that.requirements[pSrc];rq?rq=that.requirements[pSrc]:(rq=that.requirements[pSrc]=new tb(_Requirement,{src:pSrc,target:that.target},that.requirements),that.requirements[pSrc].target=tb.loader),rq.done&&rq.trigger("onLoad")}},Loader.prototype={namespace:"_Head",load:function(pSrc,pCallback){var type,rg,that=this,pCallback=pCallback||function(e){console.log("onLoad dummy handler on",e)},pSrc="string"==typeof pSrc?[pSrc]:pSrc,pSrc=[].concat.call([],pSrc);pSrc.forEach(function(filename){type=getTypeFromSrc(filename),rg=!!that.requirementGroups[type],rg||(that.requirementGroups[type]=new tb(_RequirementGroup,{type:type},that.requirementGroups),that.requirementGroups[type].target=tb.loader),rg=that.requirementGroups[type],rg.load(filename)}),pSrc.callback=pCallback,pSrc.done=function(pFilename){pSrc.indexOf(pFilename)>-1&&pSrc.splice(pSrc.indexOf(pFilename),1)},that.rqSets.push(pSrc)},get:function(pFileName){var that=this,type=getTypeFromSrc(pFileName),rg=!!that.requirementGroups[type]&&that.requirementGroups[type],rq=!!rg&&(!!rg.requirements[pFileName]&&rg.requirements[pFileName]);return rq?rq.data():"data missing for: "+pFileName},idle:function(){var that=this;return!!that.rqSets}},tb.loader=new tb(Loader)}()):console.log("tb.Require not implemented yet for node use!!!");