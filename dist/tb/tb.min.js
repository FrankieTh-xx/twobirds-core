this.Element&&function(ElementPrototype){ElementPrototype.matches=ElementPrototype.matches||ElementPrototype.matchesSelector||ElementPrototype.webkitMatchesSelector||ElementPrototype.msMatchesSelector||function(selector){for(var node=this,nodes=(node.parentNode||node.document).querySelectorAll(selector),i=-1;nodes[++i]&&nodes[i]!==node;);return!!nodes[i]}}(Element.prototype),this.Element&&function(ElementPrototype){ElementPrototype.closest=ElementPrototype.closest||function(selector){for(var el=this;el.matches&&!el.matches(selector);)el=el.parentNode;return el.matches?el:null}}(Element.prototype),tb=function(){function TbSelector(pSelector,pDomNode){var that=this;if(that.length=0,!pSelector||pSelector instanceof tb.Selector)return that;if(pSelector instanceof tb)return[].push.call(that,pSelector),that;switch(typeof pSelector){case"string":tb.dom(pSelector+"[data-tb]",pDomNode||document.window).forEach(function(pThisNode){pThisNode.tb&&Object.keys(pThisNode.tb).forEach(function(pKey){[].push.call(that,pThisNode.tb[pKey])})});break;case"object":if(pSelector instanceof tb)return[].push.call(that,pSelector),that;pSelector instanceof RegExp?tb.dom("[data-tb]",pDomNode||document.window).forEach(function(pDomNode){Object.keys(pDomNode.tb).forEach(function(pKey){var tbElement=pDomNode.tb[pKey];tbElement instanceof tb&&tbElement.namespace&&tbElement.namespace.match(pSelector)&&[].push.call(that,tbElement)})}):pSelector.nodeType&&pSelector.tb?Object.keys(pSelector.tb).forEach(function(pKey){[].push.call(that,pSelector.tb[pKey])}):(pSelector.constructor===Array||pSelector.length&&pSelector[0]&&!(pSelector instanceof Array))&&[].forEach.call(pSelector,function(pThisSelector){var thisResult=tb(pThisSelector);[].forEach.call(thisResult,function(pTbElement){-1===[].indexOf.call(that,pTbElement)&&[].push.call(that,pTbElement)})});break;case"function":tb.dom("[data-tb]",pDomNode||document.window).map(function(pDomNode){Object.keys(pDomNode.tb).forEach(function(pKey){var tbElement=pDomNode.tb[pKey];tbElement instanceof tb&&tbElement instanceof pSelector&&[].push.call(that,tbElement)})})}return that}function Nop(){}function tb(){function mergeHandlers(pSourceTb,pTargetTb){for(var i in pSourceTb.handlers)if(pSourceTb.handlers.hasOwnProperty(i)){pTargetTb.handlers[i]||(pTargetTb.handlers[i]=[]);for(var j=0,l=pSourceTb.handlers[i].length;j<l;j++)pTargetTb.handlers[i].push(pSourceTb.handlers[i][j])}}var that=this;if(!(that instanceof tb))return new TbSelector(arguments[0]?arguments[0]:void 0);var tbInstance,tempInstance,isNamespace="string"==typeof arguments[0],fileName=(isNamespace&&"/"===arguments[0].substr(0,1),isNamespace?"/"+arguments[0].replace(/\./g,"/").replace(/^\//,"")+".js":""),tbClass=isNamespace?tb.namespace(arguments[0].replace(/^\//),"").get():arguments[0];if(isNamespace&&!tbClass)return tempInstance=new tb(Nop,arguments[1]||{},arguments[2]||!1),tb.require(fileName).then(function(args){return function(){var thisTb=new tb(args[0],args[1]||{},args[2]||!1);if(tempInstance){for(var i in tempInstance)["handlers","target"].indexOf(i)===-1&&tempInstance.hasOwnProperty(i)&&(thisTb[i]=tempInstance[i]);mergeHandlers(tempInstance,thisTb)}}}([].slice.call(arguments))),tempInstance;if("function"==typeof tbClass){if(tbClass.prototype.__tb__||(Object.defineProperty(tbClass.prototype,"__tb__",{value:"V7",enumerable:!0}),Object.setPrototypeOf(tbClass.prototype,tb.prototype)),tbInstance=new tbClass(arguments[1]||{},arguments[2]),tbInstance.namespace||tbInstance instanceof Nop||(tbInstance.namespace="string"==typeof arguments[0]?arguments[0]:arguments[0].namespace||tb.getId()),tbInstance.target=tbInstance.target||arguments[2]||!1,tbInstance.target||arguments[2]&&(!arguments[2].nodeType&&arguments[2][0]&&arguments[2][0].nodeType&&(arguments[2]=arguments[2][0]),tbInstance.target=arguments[2]),tbInstance.target&&tbInstance.target.nodeType&&!(tbInstance instanceof Nop)){tbInstance.target.tb=tbInstance.target.tb||{},tbInstance.target.tb[tbInstance.namespace]=tbInstance;var dom=tb.dom(tbInstance.target);if("head"!==tbInstance.target.nodeName&&dom.parents().toArray().indexOf(document.head)===-1&&tbInstance.namespace&&dom.addClass(tbInstance.namespace.replace(/\./g,"-").toLowerCase()),tbInstance.target&&tbInstance.target.nodeType){var dataTb=tbInstance.target.getAttribute("data-tb");dataTb&&dataTb.length&&-1===dataTb.split(" ").indexOf(tbInstance.namespace)?tbInstance.target.setAttribute("data-tb",dataTb+" "+tbInstance.namespace):tbInstance.target.setAttribute("data-tb",tbInstance.namespace)}}if(tbInstance.handlers)for(var i in tbInstance.handlers)tbInstance.handlers.hasOwnProperty(i)&&("function"==typeof tbInstance.handlers[i]?tbInstance.handlers[i]=[tbInstance.handlers[i]]:tbInstance.handlers[i]instanceof Array||delete tbInstance.handlers[i]);else tbInstance.handlers={};if(!(tbInstance instanceof Nop)){tbInstance["tb.Require"]||tbInstance.trigger("init");for(var key in tbInstance)"string"==typeof key&&key.indexOf(".")>-1&&("tb.Require"===key?tbInstance["tb.Require"]=tb.require(tbInstance["tb.Require"]).then(function(pValue){tbInstance.trigger("init")}):tbInstance[key]=new tb(key,tbInstance[key],tbInstance))}return tbInstance}}function walkSelector(pSelectorObject,pMethodName,pArguments){var result,ret=tb("");return pSelectorObject instanceof TbSelector&&[].forEach.call([].map.call(pSelectorObject,function(pElement,pKey){if(pSelectorObject.hasOwnProperty(pKey))return pSelectorObject[pKey]}),function(pTbObject,pKey){result=pTbObject[pMethodName].apply(pTbObject,[].slice.call(pArguments)),[].forEach.call(result,function(pResultObject){[].indexOf.call(ret,pResultObject)===-1&&[].push.call(ret,pResultObject)})}),ret}function _mapArrayMethod(pMethodName){var method=[][pMethodName];return-1<["pop","push","unshift","shift","splice"].indexOf(pMethodName)?function(){var that=this,ret=method.apply(that,arguments);return ret?ret instanceof Array?tb(ret):ret:that}:function(){var that=this,ret=method.apply(that.toArray(),arguments);return ret instanceof Array?that.flush().add(ret):ret}}var internaltb;return Nop.prototype={namespace:"Nop"},internaltb=tb,tb.Selector=TbSelector,tb.prototype=function(){return{set:function(pKey,pValue){var that=this;return that instanceof TbSelector?([].forEach.call(that,function(pElement){pElement.set(pKey,pValue)}),that):(that instanceof tb&&(that[pKey]=pValue),that)},get:function(pKey,undefined){var that=this;return that instanceof TbSelector?that[0][pKey]:that instanceof tb?that[pKey]:undefined},trigger:function(pEvent,pEventData,pBubble){var tbEvent,that=this;if(!tb.stop()){if(tbEvent=pEvent instanceof tb.Event?pEvent:new tb.Event(pEvent,pEventData,pBubble),tbEvent.__stopped__)return that;if(that instanceof TbSelector&&that.length)[].forEach.call(that,function(tbInstance){tbInstance&&tbInstance instanceof tb&&!tbEvent.__immediateStopped__&&tbInstance.trigger(tbEvent)});else if(that instanceof tb){if(that instanceof Nop&&"init"!==tbEvent.name)return that.one("init",function(){var that=this;that.trigger(tbEvent)}),that;if(that.handlers[tbEvent.name]&&tbEvent.bubble.indexOf("l")>-1){var temp=[];that.handlers[tbEvent.name].map(function(handler){tbEvent.bubble.indexOf("l")>-1&&!tbEvent.__immediateStopped__&&handler&&(setTimeout(function(){try{handler.apply(that,[tbEvent])}catch(e){console.error(e)}},0),handler.once||temp.push(handler))}),temp.length?that.handlers[tbEvent.name]=temp:(that.handlers[tbEvent.name]=null,delete that.handlers[tbEvent.name])}if(tbEvent.__stopped__)return that;setTimeout(function(){tbEvent.bubble.indexOf("u")>-1&&that.parent().trigger(new tb.Event(tbEvent.name,tbEvent.data,"lu")),tbEvent.bubble.indexOf("d")>-1&&[].forEach.call(that.children(),function(tbObject){tbObject.trigger(new tb.Event(tbEvent.name,tbEvent.data,"ld"))})},0)}return that}},on:function(pEventName,pHandler,pOnce){var eventNames,that=this;return that instanceof TbSelector?walkSelector(that,"on",arguments):that instanceof tb&&(eventNames=-1<pEventName.indexOf(" ")?pEventName.split(" "):[pEventName],pHandler.once=!!pHandler.once||!!pOnce,eventNames.forEach(function(pThisEventName){that.handlers||(that.handlers={}),that.handlers[pThisEventName]||(that.handlers[pThisEventName]=[]),that.handlers[pThisEventName].push(pHandler)})),that},one:function(pEventName,pHandler){var that=this;return that.on(pEventName,pHandler,!0),that},off:function(pEventName,pHandler){var index,eventNames,that=this;return"undefined"==typeof pEventName?that:(that instanceof TbSelector?walkSelector(that,"off",arguments):that instanceof tb&&(eventNames=-1<pEventName.indexOf(" ")?pEventName.split(" "):[pEventName],eventNames.forEach(function(pThisEventName){if(that.handlers[pThisEventName])if("undefined"!=typeof pHandler)for(index=that.handlers[pThisEventName].indexOf(pHandler);index>-1;)that.handlers[pThisEventName].splice(index,1),index=that.handlers[pThisEventName].indexOf(pHandler),0===that.handlers[pThisEventName].length&&(that.handlers[pThisEventName]=null,delete that.handlers[pThisEventName]);else that.handlers[pThisEventName]=null,delete that.handlers[pThisEventName]})),that)},parents:function(pSelector){var that=this,ret=tb();return that instanceof TbSelector?ret=walkSelector(that,"parents",arguments):that instanceof tb&&that.target&&(that.target.nodeType?tb.dom(that.target).parents("[data-tb]").not("html").toArray().forEach(function(pElement){Object.keys(pElement.tb).forEach(function(pKey){[].push.call(ret,pElement.tb[pKey])})}):that.target instanceof tb&&([].push.call(ret,that.target),that.target.parent()[0]&&[].push.call(ret,that.target.parent()[0]))),pSelector?ret.filter(pSelector):ret},parent:function(pSelector){var that=this,ret=tb();if(that instanceof TbSelector)ret=walkSelector(that,"parent",arguments);else if(that instanceof tb&&that.target)if(that.target.nodeType){var tbParents=that.parents().toArray(),tbParent=!!tbParents[0]&&tbParents[0];if(!tbParent)return ret;Object.keys(tbParent.target.tb).forEach(function(pKey){[].push.call(ret,tbParent.target.tb[pKey])})}else that.target instanceof tb&&[].push.call(ret,that.target);return pSelector?ret.filter(pSelector):ret},descendants:function(pSelector,pLocalOnly){var that=this,ret=tb();return that instanceof TbSelector?ret=walkSelector(this,"descendants",arguments):that instanceof tb&&that.target.nodeType&&!pLocalOnly?tb.dom("[data-tb]",that.target).forEach(function(pDomNode){Object.keys(pDomNode.tb).forEach(function(pKey){[].push.call(ret,pDomNode.tb[pKey])})}):that instanceof tb&&pLocalOnly&&Object.keys(that).forEach(function(pKey){if("target"!==pKey&&that[pKey]instanceof tb){[].push.call(ret,that[pKey]);for(var desc=tb.dom().toArray.call(that[pKey].descendants("",!0)),j=0,l=desc.length;j<l;j++)[].push.call(ret,desc[j])}}),pSelector?ret.filter(pSelector):ret},children:function(pSelector,pLocalOnly){var that=this,ret=tb(),pLocalOnly="undefined"!=typeof module||pLocalOnly;if(that instanceof TbSelector)ret=walkSelector(that,"children",arguments);else if(that instanceof tb&&that.target.nodeType&&!pLocalOnly){var id=tb.getId(),selector=tb.dom("[data-tb]",that.target),notSelector='[data-tempid="'+id+'"] [data-tb] *';tb.dom(that.target).attr("data-tempid",id),selector.not(notSelector).forEach(function(pDomNode){Object.keys(pDomNode.tb).forEach(function(pKey){[].push.call(ret,pDomNode.tb[pKey])})}),tb.dom(that.target).removeAttr("data-tempid")}else if(pLocalOnly)for(var i in that)that.hasOwnProperty(i)&&that[i]instanceof tb&&[].push.call(ret,that[i]);return pSelector?ret.filter(pSelector):ret},next:function(pSelector){var result,index,that=this,ret=tb("");return that instanceof TbSelector?ret=walkSelector(this,"next",arguments):(result=that.parent().children(),index=[].indexOf.call(result,that),result.length>index+1&&[].push.call(ret,result[index+1])),pSelector?ret.filter(pSelector):ret},prev:function(pSelector){var result,index,that=this,ret=tb("");return that instanceof TbSelector?ret=walkSelector(this,"prev",arguments):(result=this.parent().children(),index=[].indexOf.call(result,this),index&&[].push.call(ret,result[index-1])),pSelector?ret.filter(pSelector):ret},first:function(pSelector){var result,that=this,ret=tb("");return that instanceof TbSelector?ret=walkSelector(this,"first",arguments):(result=this.parent().children(),[].push.call(ret,result[0])),pSelector?ret.filter(pSelector):ret},last:function(pSelector){var result,that=this,ret=tb("");return that instanceof TbSelector?ret=walkSelector(this,"last",arguments):(result=this.parent().children(),[].push.call(ret,result[result.length-1])),pSelector?ret.filter(pSelector):ret},toArray:function(){return[].filter.call(this,function(){return!0})},filter:function(pSelector){var that=this,compare=tb(pSelector),ret=tb();return pSelector?(that instanceof TbSelector?[].forEach.call(that,function(tbObject){-1<[].indexOf.call(compare,tbObject)&&[].push.call(ret,tbObject)}):that instanceof tb&&-1<[].indexOf.call(compare,that)&&[].push.call(ret,that),ret):that},not:function(pSelector){var that=this,compare=tb(pSelector).toArray(),ret=tb();return[].forEach.call(that,function(pTbInstance){compare.indexOf(pTbInstance)===-1&&[].push.call(ret,pTbInstance)}),ret},add:function(pSelector){var that=this,add=tb(pSelector).toArray(),ret=that.toArray();return tb(ret.concat(add))},flush:function(){var that=this;if(that instanceof TbSelector)for(;that.length;)that.pop();return that}}}(),TbSelector.prototype={concat:_mapArrayMethod("concat"),every:_mapArrayMethod("every"),forEach:_mapArrayMethod("forEach"),indexOf:_mapArrayMethod("indexOf"),map:_mapArrayMethod("map"),pop:_mapArrayMethod("pop"),push:_mapArrayMethod("push"),reduce:_mapArrayMethod("reduce"),reduceRight:_mapArrayMethod("reduceRight"),reverse:_mapArrayMethod("reverse"),shift:_mapArrayMethod("shift"),slice:_mapArrayMethod("slice"),some:_mapArrayMethod("some"),splice:_mapArrayMethod("splice"),unshift:_mapArrayMethod("unshift")},Object.keys(tb.prototype).forEach(function(pMethodOrStaticProperty){TbSelector.prototype[pMethodOrStaticProperty]=tb.prototype[pMethodOrStaticProperty]}),TbSelector.prototype.unique=function(){var that=this,result=[];return[].forEach.call(that,function(pElement){result.indexOf(pElement)===-1&&result.push(pElement)}),tb.dom(result)},tb.plugin=function(internalProto){return function(pMethodName,pFunction){var p=internalProto;p[pMethodName]?console.warn("tb.plugin(): Cannot overload existing tb method (",pMethodName,")"):p[pMethodName]=pFunction}}(internaltb.prototype),tb}(),tb.Event=function(pEventName,pEventData,pBubble){var that=this;that.bubble=pBubble||"l",that.data=pEventData||{},that.name=pEventName||"",that.__stopped__=that.__immediateStopped__=!1},tb.Event.prototype={stopPropagation:function(){return this.__stopped__=!0,this},stopImmediatePropagation:function(){return this.stopPropagation(),this.__immediateStopped__=!0,this}},"undefined"!=typeof module?module.exports=tb:!function(){function domReady(){tb.attach(document.body)}document.addEventListener?document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,!1),domReady()},!1):document.attachEvent&&document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",arguments.callee),domReady())})}(),tb.debug=!1,"undefined"==typeof module&&(tb.dom=function(){function _addEvent(pDomNode,pEventName,pHandler,pCapture){pDomNode.attachEvent?pDomNode.attachEvent("on"+pEventName,pHandler,pCapture):pDomNode.addEventListener(pEventName,pHandler,pCapture)}function _removeEvent(pDomNode,pEventName,pHandler,pCapture){pDomNode.detachEvent?pDomNode.detachEvent("on"+pEventName,pHandler,pCapture):pDomNode.removeEventListener(pEventName,pHandler,pCapture)}function _htmlToElements(html){var template=document.createElement("template");return template.innerHTML=html,template.content.childNodes?template.content.childNodes:template.childNodes}function _mapArrayMethod(pMethodName){var method=[][pMethodName];return-1<["push","unshift"].indexOf(pMethodName)?function(){return method.apply(this,arguments),this.unique()}:function(){var ret=method.apply(this,arguments);return ret instanceof Array&&ret[0]&&ret[0].nodeType?tb.dom(ret).unique():ret}}function add(pSelector){var res,that=this;return"string"!=typeof pSelector&&pSelector.length?[].forEach.call(pSelector,function(pSelected){res=tb.dom(pSelected).toArray(),res.forEach(function(pDomNode){[].indexOf.call(that,pDomNode)===-1&&[].push.call(that,pDomNode)})}):(res=tb.dom(pSelector).toArray(),res.forEach(function(pDomNode){[].indexOf.call(that,pDomNode)===-1&&[].push.call(that,pDomNode)})),that.unique()}function addClass(pClassName){var that=this;return that.forEach(function(pDomNode){var index,classes=pDomNode.getAttribute("class")||"";classes=classes.length?classes.split(" "):[],index=classes.indexOf(pClassName),index===-1&&(classes.push(pClassName),pDomNode.setAttribute("class",classes.join(" ")))}),that}function append(pElement){var nodes,that=this;return that.forEach(function(pDomNode){nodes=tb.dom(pElement),[].forEach.call(nodes,function(pThisElement){pThisElement.nodeType&&pDomNode.appendChild(pThisElement)})}),that}function appendTo(pElement){var that=this;return pElement=tb.dom(pElement),pElement[0]&&(pElement=pElement[0],that.forEach(function(pDomNode){pElement.appendChild(pDomNode)})),that}function attr(pKey,pValue){var rootNodes,that=this,attributes={};if("object"==typeof pKey&&pKey.constructor===Object)Object.keys(pKey).forEach(function(thisKey){that.attr(thisKey,pKey[thisKey])});else{if(!arguments.length)return[].forEach.call(that[0].attributes,function(pAttribute){attributes[pAttribute.name]=pAttribute.value}),attributes;if(!pValue&&that.length>0)return that[0].getAttribute(pKey);rootNodes=that.toArray(),rootNodes.forEach(function(pNode){pNode.setAttribute(pKey,pValue)})}return that}function children(pSelector){var that=this,result=tb.dom();return that.forEach(function(pDomNode){var check=void 0!==pSelector&&tb.dom(pSelector,pDomNode);[].forEach.call(pDomNode.children,function(pChildNode){-1===[].indexOf.call(result,pChildNode)&&(!check||-1<[].indexOf.call(check,pChildNode))&&result.push(pChildNode)})}),result}function clean(){var that=this;return that.forEach(function(pElement){var treeWalker=document.createTreeWalker(pElement,128);for(pElement.normalize();treeWalker.nextNode();)setTimeout(function(pNode){return function(){pNode.remove()}}(treeWalker.currentNode),0)}),that}function descendants(pSelector){var ret,that=this,result=[],check=!!pSelector&&tb.dom(pSelector);return that.forEach(function(pDomNode){result=result.concat(tb.dom(pDomNode.querySelectorAll("*")).toArray())}),result=tb.dom(result).unique().toArray(),check&&(ret=result.filter(function(pDomNode){return-1<[].indexOf.call(check,pDomNode)})),tb.dom(check?ret:result)}function empty(){var that=this;return that.forEach(function(pNode){pNode.innerHTML=""}),that}function filter(pSelector){var result,that=this,compare=tb.dom(pSelector);return"undefined"===pSelector?that:("string"==typeof pSelector?result=[].filter.call(that,function(pElement){return-1<compare.indexOf(pElement)}):pSelector instanceof Function&&(result=[].filter.call(that,pSelector)),tb.dom(result))}function hasClass(pClass){var that=this,node=!!that[0]&&that[0];if(node)return node.className.split(" ").indexOf(pClass)>-1}function hide(){var that=this;return that.forEach(function(pNode){pNode.style.prevDisplay=["","none"].indexOf(pNode.style.display)===-1?pNode.style.display:"",pNode.style.display="none"}),that}function html(pHtml){var that=this;return"undefined"==typeof pHtml?that[0]?that[0].innerHTML:"":("string"==typeof pHtml&&that.forEach(function(pNode){pNode.innerHTML=pHtml}),that)}function insertBefore(pTarget){var that=this,target=!!tb.dom(pTarget)[0]&&tb.dom(pTarget)[0];if(target)return that.forEach(function(pDomNode){pDomNode.nodeType&&target.parentElement.insertBefore(pDomNode.cloneNode(!0),pTarget)}),that}function insertAfter(pTarget){var that=this,target=!!tb.dom(pTarget)[0]&&tb.dom(pTarget)[0],nextDomNode=target.nextSibling||!1;if(target)return that.forEach(function(pDomNode){pDomNode.nodeType&&(nextDomNode?target.parentElement.insertBefore(pDomNode.cloneNode(!0),nextDomNode):target.parentElement.appendChild(pDomNode.cloneNode(!0)))}),that}function not(pSelector){var that=this,result=tb.dom(),check=void 0!==pSelector&&document.querySelectorAll(pSelector);return check?(that.forEach(function(pElement){-1===[].indexOf.call(check,pElement)&&result.add(pElement)}),result):that}function off(pEventName,pHandler,pCapture){var that=this,eventNames=pEventName.indexOf(" ")>-1?pEventName.split(" "):[pEventName],capture="boolean"==typeof pCapture&&pCapture;return that.forEach(function(pDomNode){pDomNode.nodeType&&(pHandler?eventNames.forEach(function(pThisEventName){_removeEvent(pDomNode,pThisEventName,pHandler,capture)}):eventNames.forEach(function(pThisEventName){pDomNode["on"+pThisEventName]=null,pDomNode.removeAttribute("on"+pThisEventName)}))}),that}function on(pEventName,pHandler,pCapture){var onceHandler,that=this,eventNames=pEventName.indexOf(" ")>-1?pEventName.split(" "):[pEventName],capture="boolean"==typeof pCapture&&pCapture;return pHandler.once&&(onceHandler=function(pHandler,capture){return function(ev){onceHandler.that.forEach(function(pDomElement){_removeEvent(pDomElement,ev.type,onceHandler,capture)}),pHandler.apply(ev,arguments)}}(pHandler,pCapture),onceHandler.that=that,onceHandler.remove=function(){that.forEach(function(pDomNode){pDomNode.nodeType&&eventNames.forEach(function(pThisEventName){_removeEvent(pDomNode,pThisEventName,onceHandler,capture)})})}),that.forEach(function(pDomNode){pDomNode.nodeType&&eventNames.forEach(function(pThisEventName){_addEvent(pDomNode,pThisEventName,onceHandler||pHandler,capture)})}),onceHandler?onceHandler:that}function one(pEventName,pHandler,pCapture){var that=this;return pHandler.once=!0,that.on(pEventName,pHandler,pCapture)}function parents(pSelector){var domNode,that=this,result=tb.dom(),check=void 0!==pSelector&&tb.dom(pSelector);return that.forEach(function(pDomNode){for(domNode=pDomNode.parentNode;domNode&&domNode.tagName&&"HTML"!==domNode.tagName;)[].indexOf.call(result,domNode)===-1&&(!check||-1<[].indexOf.call(check,domNode))&&result.push(domNode),domNode=domNode.parentNode}),result}function parent(pSelector){var that=this,result=tb.dom(),check=void 0!==pSelector&&tb.dom(pSelector);return that.forEach(function(pDomNode){var domNode=pDomNode.parentNode;-1===[].indexOf.call(result,domNode)&&(!check||-1<[].indexOf.call(check,domNode))&&[].push.call(result,domNode)}),result}function remove(pDomNodes){var that=this;return that.forEach(function(pDomNode,pIndex){that[pIndex]=pDomNode.parentNode.removeChild(pDomNode)}),that}function removeAttr(pKeys){var name,i,that=this,attrNames=pKeys&&pKeys.match(regExWord);return that.forEach(function(pDomNode){if(i=0,attrNames&&pDomNode.nodeType&&1===pDomNode.nodeType)for(;name=attrNames[i++];)pDomNode.removeAttribute(name)}),that}function removeClass(pClassName){var that=this,pClasses=pClassName.split(" ");return that.forEach(function(pDomNode){var classes=pDomNode.getAttribute("class")||"";classes=classes.trim(),classes=classes.indexOf(" ")>-1?classes.split(" "):[classes],pClasses.forEach(function(pClass){classes&&(pClassName.split(" ").forEach(function(pRemoveClass){for(;classes.indexOf(pRemoveClass)>-1;)classes.splice(classes.indexOf(pRemoveClass),1)}),classes.length?tb.dom(pDomNode).attr("class",classes.join(" ")):tb.dom(pDomNode).removeAttr("class"))})}),that}function show(){var that=this;return that.forEach(function(pNode){pNode.style.display=pNode.style.prevDisplay}),that}function toArray(){return[].filter.call(this,function(){return!0})}function toggleClass(pClassName){var $pNode,that=this;return that.forEach(function(pNode){$pNode=tb.dom(pNode),$pNode[$pNode.hasClass(pClassName)?"removeClass":"addClass"](pClassName)}),that}function trigger(pEventName,pData,pBubble,pCancel){var e,bubble="boolean"!=typeof pBubble||pBubble,cancel="boolean"!=typeof pCancel||pCancel,that=this,eventNames=pEventName.split(" ");return that.forEach(function(pDomNode){pDomNode.nodeType&&eventNames.forEach(function(pThisEventName){"createEvent"in document?(e=document.createEvent("HTMLEvents"),tb.extend(e.data,pData),e.initEvent(pThisEventName,bubble,cancel),pDomNode.dispatchEvent(e)):(e=document.createEventObject(),tb.extend(e.data,pData),e.eventType=pThisEventName,pDomNode.fireEvent("on"+e.pThisEventName,e))})}),that}function unique(){var that=this,result=[];return[].forEach.call(that,function(pElement){result.indexOf(pElement)===-1&&result.push(pElement)}),tb.dom(result)}function val(pValue){function isInput(pElement){return 1===pElement.nodeType&&inputTags.indexOf(pElement.tagName.toLowerCase())>-1&&excludeTypes.indexOf(pElement.type)===-1}var ret,that=this,inputTags="input select textarea".split(" "),excludeTypes="button file image reset submit".split(" "),valHandlers={select:function(pValue){var ret,that=this,multiSelect="select-multiple"===that.type;return arguments.length?(pValue=pValue.constructor!==Array?[pValue]:pValue,pValue=multiSelect||pValue.constructor!==Array?pValue:[pValue[0]],[].forEach.call(that.options,function(pOption){var val,valIndex=pValue.indexOf(pOption.value);valIndex+1?(val=pValue[valIndex],pOption.selected=!!val):pOption.selected=!1}),pValue.forEach(function(pOption){tb.dom('option[value="'+pOption+'"]',that).selected=!0}),that):(ret=[],[].forEach.call(that.selectedOptions,function(pOption){if(pOption.selected&&!(pOption.disabled||pOption.parentNode.disabled&&"optgroup"===pOption.parentNode.nodeName)){var value=pOption.value;ret.push(value)}}),multiSelect?ret:ret[0]?ret[0]:"")},"default":function(pValue){var ret,that=this;if("radio"===that.type){var name=that.name,selector='[type="radio"][name="'+name+'"]',radios=tb.dom(that).parents("form").descendants(selector);return ret="",radios.forEach(function(pRadio){var isElement;"undefined"!=typeof pValue?(isElement=pRadio.value===pValue,pRadio.checked=!!isElement,ret=pRadio.checked?pRadio.value:ret):pRadio.checked===!0&&(ret=pRadio.value)}),ret}return"checkbox"===that.type?("undefined"!=typeof pValue?(that.checked=!!pValue,ret=that.checked):(ret=!1,that.checked===!0&&(ret=!0)),ret):arguments.length?(null==pValue?pValue="":"number"==typeof val&&(pValue+=""),void(that.value=pValue)):(ret=that.value,"string"==typeof ret?ret:null==ret?"":ret)}};return arguments.length?(that.forEach(function(pElement){isInput(pElement)&&(ret=valHandlers[pElement.tagName.toLowerCase()]?valHandlers[pElement.tagName.toLowerCase()].call(pElement,pValue):valHandlers["default"].call(pElement,pValue))}),that):(that.some(function(pElement){return!!isInput(pElement)&&(ret=valHandlers[pElement.tagName.toLowerCase()]?valHandlers[pElement.tagName.toLowerCase()].call(pElement):valHandlers["default"].call(pElement),!0)}),ret)}function values(){function Values(){}var values,that=this,node=that[0]||void 0;return node?(node.values=node.values?node.values:tb.observable({}),Values.prototype={observe:function(pCallback,pOnce){node.values.observe(pCallback,pOnce)},encodeURIComponents:function(pNameArray){var values={},that=this;return Object.keys(this).forEach(function(pKey){var val=that[pKey];"string"==typeof val&&(!pNameArray||pNameArray.indexOf(pKey)>-1)?values[pKey]=encodeURIComponent(val):values[pKey]=val}),values}},values=new Values,Object.defineProperty(that,"values",{enumerable:!0,configurable:!0,set:function(pObject){node.values.enableNotify(!1),Object.keys(pObject).forEach(function(pKey){that.values[pKey]=pObject[pKey]}),node.values.enableNotify().notify()},get:function(node,observable){return function(){var fields=tb.dom("input[name],select[name],textarea[name]",node);return fields.forEach(function(pField){var key=tb.dom(pField).attr("name");values.hasOwnProperty(key)||Object.defineProperty(values,key,{enumerable:!0,get:function(){return tb.dom(pField).val()},set:function(pValue){var ret=tb.dom(pField).val(pValue);return observable(values),ret}})}),node.values(values),values}}(node,node.values)}),that.values):that}var dom,f,regExWord=/\S+/g,TbSelector=tb.Selector;return dom=function(pSelector,pDomNode){var domNode,nodeList,that=this;if(!pSelector){var t=tb.dom(document.body);return t.shift(),t}if(pSelector.nodeType)return void([].indexOf.call(that,pSelector)===-1&&[].push.call(that,pSelector));if(pSelector.__tbSelector__)return pSelector;if(pSelector instanceof TbSelector&&pSelector[0])return void[].forEach.call(pSelector,function(pElement){pElement.target&&pElement.target.nodeType&&[].indexOf.call(that,pElement.target)===-1&&[].push.call(that,pElement.target)});if(pSelector instanceof Array||pSelector.__tbSelector__||pSelector instanceof HTMLCollection||pSelector instanceof NodeList)return void[].forEach.call(pSelector,function(pElement){tb.dom(pElement).forEach(function(pFoundDomNode){[].indexOf.call(that,pFoundDomNode)===-1&&[].push.call(that,pFoundDomNode)})});if("string"==typeof pSelector){var DOM=_htmlToElements(pSelector);return 1!==DOM.length||3!==DOM[0].nodeType?tb.dom(DOM):(domNode=pDomNode&&pDomNode.nodeType?pDomNode:document,void pSelector.split(",").forEach(function(pThisSelector){nodeList=domNode.querySelectorAll(pThisSelector.trim()),nodeList[0]&&[].forEach.call(nodeList,function(pDomElement){[].indexOf.call(that,pDomElement)===-1&&[].push.call(that,pDomElement)})}))}},dom.prototype={__tbSelector__:!0,length:0,concat:_mapArrayMethod("concat"),every:_mapArrayMethod("every"),forEach:_mapArrayMethod("forEach"),indexOf:_mapArrayMethod("indexOf"),map:_mapArrayMethod("map"),pop:_mapArrayMethod("pop"),push:_mapArrayMethod("push"),reduce:_mapArrayMethod("reduce"),reduceRight:_mapArrayMethod("reduceRight"),reverse:_mapArrayMethod("reverse"),shift:_mapArrayMethod("shift"),slice:_mapArrayMethod("slice"),some:_mapArrayMethod("some"),splice:_mapArrayMethod("splice"),unshift:_mapArrayMethod("unshift"),add:add,addClass:addClass,append:append,appendTo:appendTo,attr:attr,children:children,clean:clean,descendants:descendants,empty:empty,hasClass:hasClass,hide:hide,html:html,insertBefore:insertBefore,insertAfter:insertAfter,filter:filter,not:not,off:off,on:on,one:one,parent:parent,parents:parents,remove:remove,removeAttr:removeAttr,removeClass:removeClass,show:show,toArray:toArray,toggleClass:toggleClass,trigger:trigger,unique:unique,val:val,values:values},f=function(pSelector,pDomNode){return new dom(pSelector,pDomNode)},f.innerProto=dom.prototype,f}(),tb.dom.plugin=function(pMethodName,pFunction){var p=tb.dom.innerProto;p[pMethodName]?console.warn("tb.dom.plugin(): Cannot overload existing tb method (",pMethodName,")"):p[pMethodName]=pFunction}),tb.nop=function(){},tb.observable=function(pStartValue){var observedValue=pStartValue,enableNotify=!0,observableFunction=function(p1,p2){function notify(){if(enableNotify)return observableFunction.lastChanged=(new Date).getTime(),observableFunction.notify()}if("undefined"==typeof p1)return observedValue;if(observedValue.constructor===Object)if("string"==typeof p1){if("undefined"==typeof p2)return tb.namespace(p1,observedValue).get();p1.indexOf(".")>-1?tb.namespace(p1,observedValue).set(p2):observedValue[p1]=p2,notify()}else"object"==typeof p1&&"undefined"==typeof p2?(observedValue=p1,notify()):console.warn("tb.observable() set value: parameter 1 should be a string or object if observed data is an object!");else{if("undefined"==typeof p1)return observedValue;observedValue=p1,notify()}return observableFunction};return observableFunction.lastChanged=(new Date).getTime(),observableFunction.notifiers=[],observableFunction.notify=function(){return observableFunction.notifiers.forEach(function(func,key){"function"==typeof func?(func(observedValue),func.once&&observableFunction.notifiers.splice(key,1)):observableFunction.notifiers.splice(key,1)}),observableFunction},observableFunction.enableNotify=function(pEnableNotify){return enableNotify=pEnableNotify!==!1,observableFunction},observableFunction.observe=function(pFunction,pOnce){
return pFunction.once=pOnce||!1,observableFunction.notifiers.push(pFunction),observableFunction},observableFunction},tb.namespace=function(){function Namespace(pNamespace,pObject){var that=this;that.namespace=pNamespace,that.target=pObject,that.namespaceArray=pNamespace.indexOf(".")?pNamespace.split("."):pNamespace,that.forceCreation=!1}function _walk(o,namespaceArray){var that=this;return!o[namespaceArray[0]]&&this.forceCreation&&(o[namespaceArray[0]]={}),namespaceArray.length<2?(that.forceCreation&&"undefined"!=typeof that.value&&(o[namespaceArray[0]]=that.value),o.hasOwnProperty(namespaceArray[0])?o[namespaceArray[0]]:void 0):o.hasOwnProperty(namespaceArray[0])?(o=o[namespaceArray[0]],namespaceArray.shift(),that._walk(o,namespaceArray)):void 0}function get(){var that=this;return that.forceCreation=!1,that._walk(that.target?that.target:window,that.namespaceArray)}function set(pValue){var that=this;return that.value=pValue,"function"==typeof that.value&&that.value.constructor.prototype!==Function.prototype&&(that.value.prototype.namespace=that.namespace),that.forceCreation=!0,that._walk(that.target?that.target:window,that.namespaceArray)}return Namespace.prototype={get:get,set:set,_walk:_walk},function(pNamespace,pObject){return new Namespace(pNamespace,pObject)}}(),tb.attach=function(pRootNode){var rootNode=pRootNode||document.body,foundElements=tb.dom(rootNode.querySelectorAll("[data-tb]")).toArray();rootNode.getAttribute("data-tb")&&(foundElements=[rootNode].concat(foundElements)),foundElements.forEach(function(pElement){var namespaces=pElement.getAttribute("data-tb").split(" ");namespaces.forEach(function(pNamespace){pElement.tb=pElement.tb||{},pElement.tb[pNamespace]||new tb(pNamespace,null,pElement)})})},tb.status={loadCount:tb.observable(0)},tb.idle=function(pCallback){var f=function(){if(0===tb.status.loadCount()){var tf=function(){0===tb.status.loadCount()?tb.status.loadCount.lastChanged===tf.lastChanged?"function"==typeof pCallback&&pCallback():(tf.lastChanged=tb.status.loadCount.lastChanged,setTimeout(tf,100)):tb.status.loadCount.observe(f,!0)};tf.lastChanged=0,setTimeout(tf,100)}else tb.status.loadCount.observe(f,!0)};tb.status.loadCount.observe(f,!0)},tb.getId=function(){return"id-"+(new Date).getTime()+"-"+Math.random().toString().replace(/\./,"")},tb.extend=function(pObj){function walk(pKey){null!==cp[pKey]&&cp[pKey].constructor&&cp[pKey].constructor===Object?pObj[pKey]=tb.extend(pObj[pKey]||{},cp[pKey]):null!==cp[pKey]&&cp[pKey].constructor&&cp[pKey].constructor===Array?pObj[pKey]=Array.from(cp[pKey]):pObj[pKey]=cp[pKey]}for(var cp;arguments[1];)cp=arguments[1],Object.keys(cp).forEach(walk),[].splice.call(arguments,1,1);return pObj},tb.parse=function(pWhat,pParse){var args=Array.prototype.slice.call(arguments);if(!args.length)return void console.error("no arguments give to parse");if(1===args.length)return args[1];if(args.length>2){for(;args.length>1;)args[0]=tb.parse(args[0],args[1]),args.splice(1,1);return args[0]}if("string"==typeof pWhat){var vars=pWhat.match(/\{[^\{\}]*\}/g);vars&&vars.forEach(function(pPropname){var propname=pPropname.substr(1,pPropname.length-2),value=tb.namespace(propname,pParse).get();"undefined"!=typeof value&&(pWhat=pWhat.replace(pPropname,value))})}else if(pWhat.constructor)switch(pWhat.constructor){case Object:Object.keys(pWhat).forEach(function(pKey){pWhat.hasOwnProperty(pKey)&&(pWhat[pKey]=tb.parse(pWhat[pKey],pParse))});break;case Array:pWhat.forEach(function(pValue,pKey){pWhat[pKey]=tb.parse(pWhat[pKey],pParse)})}return pWhat},tb.Promise=function(){"use strict";function Promise(fn){if(fn=fn||tb.nop,"object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._deferredState=0,this._state=0,this._value=null,this._deferreds=null,fn!==tb.nop&&doResolve(fn,this)}function _then(onFulfilled,onRejected){if(!(this instanceof Promise))return safeThen(this,onFulfilled,onRejected);var res=new Promise(tb.nop);return handle(this,new Handler(onFulfilled,onRejected,res)),res}function _catch(pFunction){return this.then(null,pFunction)}function _done(onFulfilled,onRejected){var that=arguments.length?this.then.apply(this,arguments):this;that.then(null,function(pValue){setTimeout(function(){throw pValue},0)})}function _finally(f){var that=this;return this.then(function(pValue){return Promise.resolve(f(that._value)).then(function(){return that._value})},function(pValue){return Promise.resolve(f(that._value)).then(function(){throw that._value})})}function getThen(obj){try{return obj.then}catch(e){return LAST_ERROR=e,IS_ERROR}}function tryCallOne(fn,a){try{return fn(a)}catch(e){return LAST_ERROR=e,IS_ERROR}}function tryCallTwo(fn,a,b){try{fn(a,b)}catch(e){return LAST_ERROR=e,IS_ERROR}}function safeThen(that,onFulfilled,onRejected){return new that.constructor(function(resolve,reject){var res=new tb.Promise(tb.nop);res.then(resolve,reject),handle(that,new Handler(onFulfilled,onRejected,res))})}function handle(that,deferred){for(;3===that._state;)that=that._value;return Promise._onHandle&&Promise._onHandle(that),0===that._state?0===that._deferredState?(that._deferredState=1,void(that._deferreds=deferred)):1===that._deferredState?(that._deferredState=2,void(that._deferreds=[that._deferreds,deferred])):void that._deferreds.push(deferred):void handleResolved(that,deferred)}function handleResolved(that,deferred){setTimeout(function(){var cb=1===that._state?deferred.onFulfilled:deferred.onRejected;if(null===cb)return void(1===that._state?resolve(deferred.promise,that._value):reject(deferred.promise,that._value));var ret=tryCallOne(cb,that._value);ret===IS_ERROR?reject(deferred.promise,LAST_ERROR):resolve(deferred.promise,ret)},0)}function resolve(that,newValue){if(newValue===that)return reject(that,new TypeError("A promise cannot be resolved with itself."));if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=getThen(newValue);if(then===IS_ERROR)return reject(that,LAST_ERROR);if(then===that.then&&newValue instanceof Promise)return that._state=3,that._value=newValue,void finale(that);if("function"==typeof then)return void doResolve(then.bind(newValue),that)}that._state=1,that._value=newValue,finale(that)}function reject(that,newValue){that._state=2,that._value=newValue,Promise._onReject&&Promise._onReject(that,newValue),finale(that)}function finale(that){if(1===that._deferredState&&(handle(that,that._deferreds),that._deferreds=null),2===that._deferredState){for(var i=0;i<that._deferreds.length;i++)handle(that,that._deferreds[i]);that._deferreds=null}}function Handler(onFulfilled,onRejected,promise){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.promise=promise}function doResolve(fn,promise){var done=!1,res=tryCallTwo(fn,function(value){done||(done=!0,resolve(promise,value))},function(reason){done||(done=!0,reject(promise,reason))});done||res!==IS_ERROR||(done=!0,reject(promise,LAST_ERROR))}var LAST_ERROR=null,IS_ERROR={};return Promise._onHandle=null,Promise._onReject=null,Promise.prototype={then:_then,"catch":_catch,"finally":_finally,done:_done},Promise.resolve=function(pValue){var ret=new tb.Promise(function(resolve,reject){});return resolve(ret,pValue),ret},Promise.reject=function(pValue){var ret=new tb.Promise(function(resolve,reject){});return reject(ret,pValue),ret},Promise.all=function(pIterable){var count=pIterable.length,observable=tb.observable(count),promise=new Promise,result=new Array(count);return pIterable.forEach(function(pValue,pIndex){pValue.then&&"function"==typeof pValue.then||(pValue=tb.Promise.resolve(pValue)),pValue.then(function(pValue){result[pIndex]=pValue})["catch"](function(pValue){0===promise._state&&reject(promise,pValue._value)})["finally"](function(pValue){observable(observable()-1)})}),observable.observe(function(pValue){0===pValue&&(observable=null,0===promise._state&&resolve(promise,result))}),promise},Promise.race=function(pIterable){var promise=new tb.Promise;return pIterable.forEach(function(pValue,pIndex,pOriginalIterable){pValue.constructor!==Promise&&(pOriginalIterable[pIndex]=Promise.resolve(pValue)),pOriginalIterable[pIndex].then(function(pValue){0===promise._state&&resolve(promise,pValue)})["catch"](function(pValue){0===promise._state&&reject(promise,pValue)})}),promise},Promise}(),tb.Require=function(pFiles){return tb.require(pFiles)},tb.Require.prototype={},tb.require=function(pFiles,pCallback){function _fsLoad(pFile){var content,promise,fs=require("fs"),type=_getTypeFromSrc(pFile);return promise=new tb.Promise(function(resolve,reject){var file=pFile;if("js"===type)try{require(file),resolve("done.")}catch(e){resolve('error reading file using require("'+file+'"")')}else if(fs.existsSync(file))try{content=fs.readFileSync(file,"utf8"),resolve(content)}catch(e){resolve("error: could not read file ["+file+"]")}else resolve("error: file not found ["+file+"]")})["finally"](function(pValue){tb.require.repo[type][pFile]=pValue})}function _load(pFile){var typeConfig,promise,typeConfigs={css:{tag:"link",attributes:{type:"text/css",rel:"stylesheet",href:"{src}"}},js:{tag:"script",attributes:{type:"text/javascript",src:"{src}"}}},type=_getTypeFromSrc(pFile),file=pFile;if(tb.require.cacheBust,typeConfigs[type])return tb.status.loadCount(tb.status.loadCount()+1),promise=new tb.Promise(function(resolve,reject){var element;typeConfig=typeConfigs[type],element=document.createElement(typeConfig.tag),element.async=!0,element.onreadystatechange=element.onload=function(){var state=element.readyState;state&&!/loaded|complete/.test(state)||resolve("1")},Object.keys(typeConfig.attributes).forEach(function(pKey){element.setAttribute(pKey,tb.parse(typeConfig.attributes[pKey],{src:pFile}))}),document.getElementsByTagName("head")[0].appendChild(element)})["finally"](function(){tb.status.loadCount(tb.status.loadCount()-1),tb.require.repo[type][pFile]="done"});var f=function(data){if("json"===type&&data.text)try{tb.require.repo[type][pFile]=JSON.parse(data.text)}catch(e){console.error("result parsing, valid JSON expected in:",data)}else tb.require.repo[type][pFile]=data.text},options={url:file};return tb.request(options)["finally"](f)}function _getTypeFromSrc(pSrc){return pSrc.split("?")[0].split(".").pop()}var ret,promiseArray=[];if(!pFiles){var warn="tb.require: no files given.";return console.warn(warn),tb.Promise.reject(warn)}return"string"==typeof pFiles&&(pFiles=[pFiles]),pFiles.forEach(function(pFile){var type=_getTypeFromSrc(pFile);if(pFile.split("/").pop().indexOf(".")===-1){var warn="tb.require: no file type given for ";return console.warn(warn,pFile),tb.Promise.reject(warn+pFile)}tb.require.repo[type]||(tb.require.repo[type]={}),tb.require.repo[type][pFile]||(tb.require.repo[type][pFile]="undefined"==typeof module?_load(pFile):_fsLoad(pFile)),promiseArray.push(tb.require.repo[type][pFile])}),ret=tb.Promise.all(promiseArray),pCallback&&ret["finally"](function(pValueArray){pCallback.call(pValueArray)}),ret},tb.require.repo={},tb.require.cacheBust=!0,tb.require.loadcount=0,tb.require.get=function(pFile){return tb.require.repo[pFile.split("?")[0].split(".").pop()][pFile]||void 0},"undefined"==typeof module&&(tb.request=function(){function getConnection(pId){var obj,xhr,getConnection;if("undefined"!=typeof ActiveXObject)for(var i=0;i<msoft.length;++i)try{xhr=new ActiveXObject(msoft[i]),obj={connection:xhr,identifier:pId},getConnection=function(pType){return function(pId){var xhr=new ActiveXObject(pType);return obj={connection:xhr,identifier:pId}}}(msoft[i])}catch(e){}try{xhr=new XMLHttpRequest,obj={connection:xhr,identifier:pId},getConnection=function(pId){var xhr=new XMLHttpRequest;return obj={connection:xhr,identifier:pId}}}catch(e){}finally{return obj}}function handleReadyState(pReq,pResolve,pStateChange,pReject,pOptions){var poll=window.setInterval(function(pReadyState){return function(){pReq.connection.readyState!==pReadyState&&(pReadyState=pReq.connection.readyState),4===pReadyState&&(pReq.aborttimer&&window.clearTimeout(pReq.aborttimer),window.clearInterval(poll),handleTransactionResponse(pReq,pResolve,pReject,pOptions))}}(0),interval);return poll}function handleTransactionResponse(pReq,pResolve,pReject,pOptions){var httpStatus,responseObject;try{httpStatus=pReq.connection.status}catch(e){httpStatus=13030}if(httpStatus>=200&&httpStatus<400){responseObject=createResponseObject(pReq,pOptions);try{pResolve(responseObject)}catch(e){tb.debug}}else responseObject=createResponseObject(pReq,tb.extend({},pOptions)),pReject(responseObject);release(pReq)}function createResponseObject(pObj,pOptions){var obj={tId:pObj.identifier,status:pObj.connection.status,statusText:pObj.connection.statusText,responseHeaders:{},requestHeaders:pOptions.headers,text:pObj.connection.responseText,xml:pObj.connection.responseXML,options:pOptions};if(pObj.connection.getAllResponseHeaders().split("\r\n").forEach(function(pSubString){var key=pSubString.split(":")[0],value=pSubString.substr(pSubString.indexOf(":")+1);pSubString&&(obj.responseHeaders[key]=value)}),pOptions.dataType&&"json"===pOptions.dataType.toLowerCase())try{obj.data=JSON.parse(pObj.connection.responseText)}catch(e){console.warn("expected JSON, could not parse: "+pObj.connection.responseText)}return obj}function release(pReq){dec(pReq),pReq.connection&&(pReq.connection=null),pReq=null}function inc(pReq){tb.status.loadCount(tb.status.loadCount()+1),loadlist.push(pReq),count++,readyState="loading"}function dec(pReq){tb.status.loadCount(tb.status.loadCount()-1),loadlist.indexOf(pReq)&&(count--,loadlist.splice(loadlist.indexOf(pReq)),0===count&&(readyState="complete"))}var loadlist=[],readyState="complete",count=0,interval=30,msoft=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];return function(pOptions){var ct,uid="tb"+tb.getId(),xmlreq=getConnection(uid),method=!!pOptions.method&&pOptions.method.toUpperCase()||"GET",url=pOptions.url,params="",successHandler=pOptions.success||tb.nop,errorHandler=pOptions.error||tb.nop,finalHandler=pOptions["finally"]||tb.nop,stateHandler=pOptions.statechange||tb.nop,isCachable=pOptions.cachable||!0,headers=pOptions.headers=pOptions.headers||{},timeout=pOptions.timeout||!1,isAsync="undefined"==typeof pOptions.async||pOptions.async!==!1;if(inc(),pOptions.type&&"json"===pOptions.type.toLowerCase()&&(headers["Content-Type"]="application/json;charset=UTF-8"),"undefined"!=typeof pOptions.params)switch(ct=headers&&headers["Content-Type"]?headers["Content-Type"]:"application/x-www-form-urlencoded"){case"application/json;charset=UTF-8":params=JSON.stringify(pOptions.params);break;default:Object.keys(pOptions.params).forEach(function(pParam){params+=(params.length>0?"&":"")+pParam+"="+pOptions.params[pParam]})}if(isCachable===!1&&(url+=(url.indexOf("?")<0?"?":"&")+"tbUid="+uid),xmlreq){var promise=new tb.Promise(function(resolve,reject){"GET"!==method&&"DELETE"!==method||""===params||(url=url+(url.indexOf("?")<0?"?":"&")+params),xmlreq.src=url,xmlreq.connection.open(method,url,isAsync),isAsync===!0&&(xmlreq.poll=handleReadyState(xmlreq,resolve,stateHandler,reject,pOptions)),Object.keys(headers).forEach(function(pHeaderVar){"Content-Type"!==pHeaderVar&&xmlreq.connection.setRequestHeader(pHeaderVar,headers[pHeaderVar])}),timeout&&(xmlreq.timeoutTimer=window.setTimeout(function(pT,pR){var f="function"==typeof pT.cb&&pT.cb;return function(){"function"==typeof f&&f(),pR.connection.abort(),window.clearInterval(pR.poll)}}(timeout,xmlreq),timeout.ms)),xmlreq.abort=function(xmlreq){return function(){window.clearInterval(xmlreq.poll),xmlreq.connection&&xmlreq.connection.abort(),release(xmlreq)}}(xmlreq),("POST"===method||"PUT"===method)&&""!==params?(xmlreq.connection.setRequestHeader("Content-Type",ct),xmlreq.connection.send(params)):xmlreq.connection.send(null),isAsync===!1&&(tb.request.dec(),xmlreq.connection.status>=200&&xmlreq.connection.status<300?resolve(createResponseObject(xmlreq,tb.extend({},pOptions))):reject(createResponseObject(xmlreq,tb.extend({},pOptions))))});return promise.then(function(pResult){successHandler(pResult)})["catch"](function(pResult){errorHandler(pResult)})["finally"](function(pResult){finalHandler(pResult)}),promise}return!1}}()),tb.stop=function(pStopIt){var stopIt=pStopIt;return function(pStopIt){return stopIt=pStopIt?pStopIt:stopIt}}(!1),"undefined"==typeof module&&(tb.Model=function(pConfig){var that=this;that.data=tb.observable({}),that.config={},tb.extend(that.config,{create:{url:"",method:"POST",success:function(pResult){that.data(pResult)}},read:{url:"",method:"GET",success:function(pResult){that.data(pResult)}},update:{url:"",method:"PUT",success:function(pResult){that.data(pResult)}},"delete":{url:"",method:"DELETE",success:function(pResult){that.data(pResult)}}},pConfig)},tb.Model.prototype=function(){return{create:function(pParams){var o=tb.extend({},this.config.create);return pParams=pParams||{},o.url?void tb.request(tb.extend(o,{url:pParams?tb.parse(this.config.create.url,pParams):this.config.create.url},{params:pParams})):void console.error("no create url given!")},read:function(pParams){var o=tb.extend({},this.config.read);return pParams=pParams||{},o.url?void tb.request(tb.extend(o,{url:pParams?tb.parse(this.config.read.url,pParams):this.config.read.url},{params:pParams})):void console.error("no read url given!")},update:function(pParams){var o=tb.extend({},this.config.update);return pParams=pParams||{},o.url?void tb.request(tb.extend(o,{url:pParams?tb.parse(this.config.update.url,pParams):this.config.update.url},{params:pParams})):void console.error("no update url given!")},"delete":function(pParams){var o=tb.extend({},this.config["delete"]);return pParams=pParams||{},o.url?void tb.request(tb.extend(o,{url:pParams?tb.parse(this.config["delete"].url,pParams):this.config["delete"].url},{params:pParams})):void console.error("no delete url given!")}}}());